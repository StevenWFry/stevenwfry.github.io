<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson 14 – Creating Views (or: giving your queries reusable disguises) - SQL Guide - swf.wtf</title>
<meta name="description" content="And look, sometimes you want people to see some of a table, but not all of it. Or you’re tired of rewriting the same five‑table join every time you need a...">
<link rel="stylesheet" href="../assets/css/site.css">
<link rel="stylesheet" href="../assets/css/sql-guide.css">
</head>
<body>

<div class="cursor" id="cursor"></div>

<nav>
  <div class="inner">
    <a href="../index.html" class="logo">swf.wtf</a>
    <a href="index.html">&larr; sql guide</a>
  </div>
</nav>

<main class="sql-page">
  <header class="sql-header">
    <div class="sql-eyebrow">SQL Guide Chapter</div>
    <h1>Lesson 14 – Creating Views (or: giving your queries reusable disguises)</h1>
    <p>And look, sometimes you want people to see some of a table, but not all of it. Or you’re tired of rewriting the same five‑table join every time you need a report. This is exactly why views exist: they give you canned, r...</p>
    <div class="sql-meta">
      <span class="sql-pill">oracle 19c</span>
      <span class="sql-pill">mysql notes</span>
      <span class="sql-pill">study chapter</span>
    </div>
  </header>

  <article class="chapter">
    <p>And look, sometimes you want people to see <em>some</em> of a table, but not <strong>all</strong> of it. Or you’re tired of rewriting the same five‑table join every time you need a report. This is exactly why <strong>views</strong> exist: they give you canned, reusable SELECTs that make ugly queries look civilized and sensitive columns mysteriously disappear.</p>
    <p>This lesson is about defining, using, and inspecting <strong>views</strong>.</p>
    <p>You will learn to:</p>
    <ul>
    <li>Explain what views are and why they exist.</li>
    <li>Create simple and complex views.</li>
    <li>Retrieve and (when allowed) modify data through views.</li>
    <li>Control DML with <code>WITH CHECK OPTION</code> and <code>WITH READ ONLY</code>.</li>
    <li>Query data dictionary views to see how views are defined.</li>
    </ul>
    <hr>
    <h2>1. What Is a View?</h2>
    <p>A <strong>view</strong> is a <strong>schema object</strong> defined by a query:</p>
    <ul>
    <li>It logically represents a <strong>subset</strong> or <strong>reformatted view</strong> of data from one or more tables.</li>
    <li>It stores <strong>no data</strong> of its own (in standard views); the data lives in the base tables.</li>
    <li>When you query a view, Oracle transparently runs the underlying query.</li>
    </ul>
    <p>Use views to:</p>
    <ul>
    <li>Restrict which columns or rows users can see (hide salaries, SSNs, etc.).</li>
    <li>Hide complex joins behind a friendly name.</li>
    <li>Present data in a different shape (e.g., annual salary instead of monthly).</li>
    <li>Provide a layer of indirection so underlying table structures can evolve.</li>
    </ul>
    <p>Think of a view as a stored <code>SELECT</code> that masquerades as a table.</p>
    <hr>
    <h2>2. Simple vs Complex Views</h2>
    <h3>2.1 Simple views</h3>
    <ul>
    <li>Based on <strong>a single table</strong>.</li>
    <li>Do not contain <strong>group functions</strong>, <code>GROUP BY</code>, <code>DISTINCT</code>, or complex expressions.</li>
    <li>Often allow <strong>INSERT</strong>, <strong>UPDATE</strong>, and <strong>DELETE</strong> operations (within rules).</li>
    </ul>
    <p>Example:</p>
    <pre><code class="language-sql">CREATE VIEW emp_basic AS
    SELECT employee_id,
           last_name,
           department_id
    FROM   employees;</code></pre>
    <h3>2.2 Complex views</h3>
    <ul>
    <li>Based on <strong>multiple tables</strong> or contain:</li>
    <li>Group functions (<code>SUM</code>, <code>AVG</code>, etc.).</li>
    <li><code>GROUP BY</code>.</li>
    <li><code>DISTINCT</code>.</li>
    <li>Expressions and joins.</li>
    <li>Generally <strong>restricted</strong> or <strong>disallowed</strong> for DML.</li>
    </ul>
    <p>Example:</p>
    <pre><code class="language-sql">CREATE VIEW dept_sal_summary AS
    SELECT d.department_id,
           d.department_name,
           MIN(e.salary) AS min_sal,
           MAX(e.salary) AS max_sal,
           AVG(e.salary) AS avg_sal
    FROM   employees e
    JOIN   departments d
           ON e.department_id = d.department_id
    GROUP  BY d.department_id, d.department_name;</code></pre>
    <p>Querying is fine; trying to <code>INSERT</code> into this view is not.</p>
    <hr>
    <h2>3. Creating and Modifying Views</h2>
    <h3>3.1 CREATE VIEW</h3>
    <p>Basic syntax:</p>
    <pre><code class="language-sql">CREATE VIEW view_name AS
    SELECT ...
    FROM   ...
    WHERE  ...;</code></pre>
    <p>Example – convert monthly salaries to annual salaries:</p>
    <pre><code class="language-sql">CREATE VIEW emp_sal_view AS
    SELECT employee_id,
           last_name,
           department_id,
           salary * 12 AS ann_sal
    FROM   employees;</code></pre>
    <p>Querying the view:</p>
    <pre><code class="language-sql">SELECT *
    FROM   emp_sal_view;</code></pre>
    <p>Returns the underlying data from <code>employees</code>, with <code>ann_sal</code> as a calculated column.</p>
    <h3>3.2 CREATE OR REPLACE VIEW</h3>
    <p>To change a view’s definition <strong>without</strong> dropping it (and losing its grants), use <code>OR REPLACE</code>:</p>
    <pre><code class="language-sql">CREATE OR REPLACE VIEW emp_sal_view AS
    SELECT employee_id,
           last_name,
           department_id,
           salary * 12 AS ann_sal
    FROM   employees
    WHERE  department_id IN (10, 90);</code></pre>
    <ul>
    <li>Existing privileges on the view are preserved.</li>
    <li>Next time users query it, they see the new definition.</li>
    </ul>
    <h3>3.3 Naming columns via aliases</h3>
    <p>You can name view columns in two ways:</p>
    <p><strong>Inline aliases in the SELECT</strong>:</p>
    <pre><code class="language-sql">CREATE VIEW salvu50 AS
    SELECT employee_id     AS id_number,
           last_name       AS name,
           salary * 12     AS ann_salary
    FROM   employees
    WHERE  department_id = 50;</code></pre>
    <p><strong>Column list in CREATE VIEW</strong>:</p>
    <pre><code class="language-sql">CREATE OR REPLACE VIEW empvu80 (employee_id, last_name, salary) AS
    SELECT employee_id,
           last_name,
           salary
    FROM   employees
    WHERE  department_id = 80;</code></pre>
    <ul>
    <li>Column list in parentheses must match the number and order of columns in the <code>SELECT</code>.</li>
    </ul>
    <hr>
    <h2>4. DML Through Views – What’s Allowed?</h2>
    <p>You can often perform <code>INSERT</code>, <code>UPDATE</code>, and <code>DELETE</code> through <strong>simple</strong> views, but there are important restrictions.</p>
    <p>In general, you <strong>cannot</strong>:</p>
    <ul>
    <li><code>DELETE</code> from a view if it contains:</li>
    <li>Group functions</li>
    <li><code>GROUP BY</code></li>
    <li><code>DISTINCT</code></li>
    <li><code>ROWNUM</code></li>
    <li><code>UPDATE</code> through a view if it includes:</li>
    <li>Group functions</li>
    <li><code>GROUP BY</code></li>
    <li><code>DISTINCT</code></li>
    <li><code>ROWNUM</code></li>
    <li>Expressions (calculated columns like <code>salary * 12</code>)</li>
    <li><code>INSERT</code> through a view if it includes:</li>
    <li>Group functions</li>
    <li><code>GROUP BY</code></li>
    <li><code>DISTINCT</code></li>
    <li><code>ROWNUM</code></li>
    <li>Expression‑based columns</li>
    <li><strong>NOT NULL</strong> columns from the base table that are <strong>not</strong> exposed in the view and have no default in the base table</li>
    </ul>
    <p>Example – why you can’t update a calculated column:</p>
    <pre><code class="language-sql">CREATE VIEW emp_sal_view AS
    SELECT employee_id,
           last_name,
           department_id,
           salary * 12 AS ann_sal
    FROM   employees;
    
    UPDATE emp_sal_view
    SET    ann_sal = 100000
    WHERE  department_id = 90;
    -- ERROR: cannot modify a virtual (derived) column</code></pre>
    <p>Because <code>ANN_SAL</code> doesn’t exist as a real column in <code>EMPLOYEES</code>, Oracle can’t map that change back.</p>
    <p>Updating a real column via the view, however, is fine (subject to constraints and triggers):</p>
    <pre><code class="language-sql">UPDATE emp_sal_view
    SET    department_id = 10
    WHERE  last_name = &#x27;Kochhar&#x27;;</code></pre>
    <p>The change applies to <code>EMPLOYEES.DEPARTMENT_ID</code>.</p>
    <hr>
    <h2>5. WITH CHECK OPTION – Preventing “Domain Escapes”</h2>
    <p>Sometimes you want to allow DML through a view, but only when the <strong>resulting row</strong> still satisfies the view’s defining <code>WHERE</code> clause.</p>
    <p><code>WITH CHECK OPTION</code> enforces this.</p>
    <p>Example – view limited to departments 10 and 90:</p>
    <pre><code class="language-sql">CREATE OR REPLACE VIEW emp_dept_10_90 AS
    SELECT employee_id,
           last_name,
           department_id
    FROM   employees
    WHERE  department_id IN (10, 90)
    WITH CHECK OPTION;</code></pre>
    <p>What this does:</p>
    <ul>
    <li>You can <strong>update</strong> rows via the view, <strong>but only</strong> if after the update <code>department_id</code> is still 10 or 90.</li>
    </ul>
    <p>Attempting:</p>
    <pre><code class="language-sql">UPDATE emp_dept_10_90
    SET    department_id = 20
    WHERE  last_name = &#x27;Kochhar&#x27;;</code></pre>
    <p>Results in:</p>
    <p>&gt; ORA-01402: view WITH CHECK OPTION where-clause violation</p>
    <p>But changing from 90 to 10 <strong>is</strong> allowed, because both values satisfy the <code>IN (10, 90)</code> condition.</p>
    <p>You can name the constraint:</p>
    <pre><code class="language-sql">... WITH CHECK OPTION CONSTRAINT emp_dept_10_90_chk;</code></pre>
    <p>Useful for tracking violations in error messages.</p>
    <hr>
    <h2>6. WITH READ ONLY – Locking Views Against DML</h2>
    <p>If you want a view to be <strong>purely read‑only</strong>, regardless of whether the underlying tables would allow DML, add <code>WITH READ ONLY</code>:</p>
    <pre><code class="language-sql">CREATE OR REPLACE VIEW empvu10 AS
    SELECT employee_id,
           last_name,
           department_id
    FROM   employees
    WHERE  department_id = 10
    WITH READ ONLY;</code></pre>
    <p>Any attempt to <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code> through <code>EMPVU10</code> results in an error.</p>
    <p>This is handy for:</p>
    <ul>
    <li>Reporting views used by many users.</li>
    <li>Views that combine multiple tables or contain logic you don’t want people accidentally “writing through.”</li>
    </ul>
    <hr>
    <h2>7. Inspecting Views via the Data Dictionary</h2>
    <p>To see what views you own and how they’re defined, use <code>USER_VIEWS</code>:</p>
    <pre><code class="language-sql">SELECT view_name,
           text
    FROM   user_views
    WHERE  view_name = &#x27;EMP_SAL_VIEW&#x27;;</code></pre>
    <ul>
    <li><code>VIEW_NAME</code> – the view’s name (upper case by default).</li>
    <li><code>TEXT</code> – the <code>SELECT</code> statement that defines the view.</li>
    </ul>
    <p>For views you can access (not just own), use <code>ALL_VIEWS</code>. DBAs can use <code>DBA_VIEWS</code> to see everything.</p>
    <p>You can also use <code>USER_OBJECTS</code> to see views alongside tables and indexes:</p>
    <pre><code class="language-sql">SELECT object_name,
           object_type,
           status
    FROM   user_objects
    WHERE  object_type = &#x27;VIEW&#x27;;</code></pre>
    <hr>
    <h2>8. Dropping Views</h2>
    <p>To remove a view definition:</p>
    <pre><code class="language-sql">DROP VIEW emp_sal_view;</code></pre>
    <ul>
    <li>This <strong>does not</strong> drop or modify the underlying base tables.</li>
    <li>Dependent privileges on the view are removed.</li>
    </ul>
    <p>If you drop a view that other code depends on, that code may become invalid until you recreate the view.</p>
    <hr>
    <h2>9. What You Should Now Be Able to Do</h2>
    <p>By the end of this lesson, you should be able to:</p>
    <ul>
    <li>Define what a view is and why you’d use one.</li>
    <li>Create simple views over a single table and complex views involving joins and aggregations.</li>
    <li>Understand which DML operations are allowed through a view and why calculated/aggregated columns can’t be updated directly.</li>
    <li>Use <code>WITH CHECK OPTION</code> to keep view‑based updates within the view’s logical domain.</li>
    <li>Use <code>WITH READ ONLY</code> to prevent all DML through a view.</li>
    <li>Use <code>USER_VIEWS</code> and related dictionary views to inspect how views are defined.</li>
    </ul>
    <p>You now have a way to hide complexity, hide sensitive data, and mildly confuse anyone who insists on thinking of views as “just tables”—which, to be fair, is exactly how they’re supposed to feel from the outside.</p>
  </article>

  <div class="chapter-nav">
    <a href="13_Creating_Sequences_Synonyms_and_Indexes.html">&larr; previous</a>
    <a href="14_Creating_Views.md">view source markdown</a>
    <a href="15_Managing_Schema_Objects.html">next &rarr;</a>
  </div>

  <div class="sql-footer">// sql-guide generated from markdown notes</div>
</main>

<script defer src="../assets/js/site.js"></script>

</body>
</html>
